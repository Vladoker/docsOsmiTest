---
title: Мониторинг
description:
---


В Платформа есть нативная поддержка Prometheus с Grafana и OpenTelemetry. Отслеживаются только метрики верхнего уровня (например, API-запросы, количество флоу/предсказаний). Список счётчиков см. в соответствующем разделе документации. Для детализированной наблюдаемости по узлам (node-by-node) используйте раздел Аналитика.


## Prometheus

Prometheus — open-source решение для мониторинга и алертинга.
Перед настройкой Prometheus задайте переменные окружения в Платформа:


```properties
ENABLE_METRICS=true
METRICS_PROVIDER=prometheus
METRICS_INCLUDE_NODE_METRICS=true
```

После установки Prometheus запустите его с конфигурационным файлом. Платформа предоставляет файл конфигурации по умолчанию (см. ссылку в документации).
Убедитесь, что инстанс Платформа тоже запущен. Откройте браузер и перейдите на порт 9090. На дашборде вы должны увидеть, что endpoint /api/v1/metrics доступен.


<figure><img src="/assets/image (178).png" alt=""><figcaption></figcaption></figure>

По умолчанию /api/v1/metrics используется Prometheus для опроса метрик.

<figure><img src="/assets/image (177).png" alt="" width="563"><figcaption></figcaption></figure>

## Grafana

Prometheus собирает метрики и даёт мощный язык запросов; Grafana превращает метрики в наглядные визуализации.
Grafana можно установить разными способами (см. руководство). По умолчанию Grafana доступна на порту 9091.

<figure><img src="/assets/image (179).png" alt=""><figcaption></figcaption></figure>

В левой панели нажмите «Add new connection», затем выберите Prometheus.

<figure><img src="/assets/image (180).png" alt=""><figcaption></figcaption></figure>

Укажите адрес Prometheus (в нашем примере он доступен на порту 9090).

<figure><img src="/assets/image (181).png" alt=""><figcaption></figcaption></figure>

Пролистайте вниз и протестируйте подключение (Test).

<figure><img src="/assets/image (182).png" alt=""><figcaption></figcaption></figure>

Обратите внимание на ID источника данных в тулбаре — он понадобится для создания дашбордов.

<figure><img src="/assets/image (184).png" alt=""><figcaption></figcaption></figure>

Теперь, когда подключение успешно добавлено, можно создавать дашборд: слева нажмите «Dashboards» → «Create Dashboard».
Платформа предоставляет 2 шаблона дашбордов:
grafana.dashboard.app.json.txt — метрики API (количество чат-флоу/agent-флоу, число предсказаний, tools, assistant, upsert’ы векторов и т. п.).


grafana.dashboard.server.json.txt — метрики node.js-инстанса Платформа (heap, CPU, RAM и пр.).

Если используете шаблоны выше, выполните **find & replace** всех вхождений `cds4j1ybfuhogb` на ID источника данных, который вы сохранили ранее.

<figure><img src="/assets/image (183).png" alt=""><figcaption></figcaption></figure>

Можно сначала импортировать шаблон, а затем отредактировать JSON.

<figure><img src="/assets/image (185).png" alt=""><figcaption></figcaption></figure>

После этого выполните несколько действий в Платформа — метрики должны появиться на графиках.

<figure><img src="/assets/image (186).png" alt=""><figcaption></figcaption></figure>

<figure><img src="/assets/image (187).png" alt=""><figcaption></figcaption></figure>

## OpenTelemetry

[OpenTelemetry](https://opentelemetry.io/) open-source фреймворк для генерации и управления телеметрией. Чтобы включить OTel, задайте переменные окружения в Платформа:

```properties
ENABLE_METRICS=true
METRICS_PROVIDER=open_telemetry
METRICS_INCLUDE_NODE_METRICS=true
METRICS_OPEN_TELEMETRY_METRIC_ENDPOINT=http://localhost:4318/v1/metrics
METRICS_OPEN_TELEMETRY_PROTOCOL=http # http | grpc | proto (default is http)
METRICS_OPEN_TELEMETRY_DEBUG=true
```

Next, we need OpenTelemetry Collector to receive, process and export telemetry data. Flowise provides a [docker compose file](https://github.com/FlowiseAI/Flowise/blob/main/metrics/otel/compose.yaml) which can be used to start the collector container.

```bash
cd Flowise
cd metrics && cd otel
docker compose up -d
```

Коллектор использует файл конфигурации otel.config.yml из той же директории. В текущей конфигурации поддерживаются Datadog и Prometheus. Для настройки других APM-инструментов (например, Zipkin, Jaeger, New Relic, Splunk и др.) см. документацию OpenTelemetry.

Не забудьте подставить необходимые API-ключи экспортеров в yml-файле.

