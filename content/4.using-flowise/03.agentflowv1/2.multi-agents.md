---
title: Multi-Agents
description:
---



## Концепция

Подобно команде узких специалистов, многоагентная система использует принцип специализации. В Платформа это реализовано как иерархический, последовательный флоу, где эффективность достигается за счёт распределения задач между специализированными агентами.

### 1. Архитектура системы

В Платформа многоагентная система — это масштабируемая ИИ-архитектура, разбивающая сложные запросы на подзадачи. Взаимодействуют три роли:


* User — инициирует запрос. Важно, чтобы запросы соответствовали назначению флоу; иначе возможны неточности, бесконечные циклы или ошибки.

* Supervisor AI — «диспетчер» флоу: анализирует запрос, декомпозирует его на подзадачи, распределяет их между Worker-агентами, агрегирует результаты и возвращает ответ пользователю.

* Worker AI Team — набор специализированных агентов (Workers), каждый решает свою подзадачу по заданным инструкциям (Промтам), использует инструменты и возвращает результат Supervisor’у.



:img{src="https://823733684-files.gitbook.io/~/files/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F00tYLwhz5RyR7fJEhrWy%2Fuploads%2Fgit-blob-07de3d51f5ade78f92093079a8560acd96656867%2Fmulti-agent-diagram.svg?alt=media" alt="01"}

### 2. Операционные ограничения

* Одна задача за раз. Supervisor последовательно делегирует одну подзадачу и ждёт результата перед следующей. Это упрощает контроль и снижает сложность.


* Один Supervisor на флоу. В текущей реализации нет «иерархий над иерархиями» (в духе «Hierarchical Agent Teams»); поддерживается один верхнеуровневый Supervisor.

Если попытаться спроектировать параллельную делегацию нескольких задач Supervisor’ом — возникнет ошибка.


## Supervisor

Требуемые компоненты:
Chat Model с поддержкой function calling — для декомпозиции, делегирования и агрегации.


Agent Memory (опционально). Полезна для возобновления работы с чекпоинтов и для использования прошлых состояний в принятии решений.

<figure><img src="https://823733684-files.gitbook.io/~/files/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F00tYLwhz5RyR7fJEhrWy%2Fuploads%2Fgit-blob-697eb0486fdbb8f118c6f922a44061c919b05c3c%2Fmas07.png?alt=media" alt=""><figcaption></figcaption></figure>

### Промт Supervisor

По умолчанию Промт инструктирует: анализировать запрос, разложить на подзадачи и делегировать их воркерам. Независимо от кастомизаций, необходимы:  
* Переменная `{team_members}` — список имён доступных Workers. По ней Supervisor понимает «штат» и выбирает исполнителя.

* Ключевое слово `FINISH` — сигнал завершения. Без него Supervisor может продолжать делегирование и не выдать финальный результат.


Роль Supervisor отличается от ролей Workers: он работает лучше с общими директивами, а не узкими инструкциями. Новичкам рекомендуется оставлять Промт по умолчанию.

<figure><img src="https://823733684-files.gitbook.io/~/files/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F00tYLwhz5RyR7fJEhrWy%2Fuploads%2Fgit-blob-eeb866684b84a6bb30973439b03c7100bbd71a4a%2Fmas06.png?alt=media" alt="" width="375"><figcaption></figcaption></figure>



### Recursion Limit (Supervisor)

Ограничивает максимальную глубину вложенных вызовов (самовызов Supervisor’а) в одном исполнении флоу — чтобы предотвратить неbounded-рекурсию и избыточное потребление ресурсов.

<figure><img src="https://823733684-files.gitbook.io/~/files/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F00tYLwhz5RyR7fJEhrWy%2Fuploads%2Fgit-blob-718db44cbb71d83cfca89eed1ba89eaa8cdea313%2Fmas04.png?alt=media" alt="" width="375"><figcaption></figcaption></figure>

### Как работает Supervisor

Получив запрос пользователя, Supervisor:
* Анализирует цель.

* По `{team_members}` (это только имена воркеров) сам выводит их специализации и выбирает подходящего Worker под каждую подзадачу.

* Поэтому имена воркеров должны быть ясными и описательными: это критично для корректной маршрутизации задач.


***

## **Worker**

Требуемые компоненты:  

* Связь с Supervisor (иерархия вызова).
* Chat Model с function calling (по умолчанию наследуется от Supervisor, но можно назначить свою).

Можно подбирать разные модели для разных Workers: удешевлять простые задачи и резервировать более дорогие модели для сложных.


<figure><img src="https://823733684-files.gitbook.io/~/files/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F00tYLwhz5RyR7fJEhrWy%2Fuploads%2Fgit-blob-6094f84897f932a5b05fc5e2a1725d9ac80095c0%2Fmas05.png?alt=media" alt="" width="375"><figcaption></figcaption></figure>


### Max Iteration (Worker)

Лимит числа взаимодействий «Supervisor ↔ конкретный Worker» в рамках одного исполнения. Это «предохранитель» от бесконечных диалогов и роста стоимости. В отличие от Supervisor Recursion Limit (самовызовы Supervisor’а), Max Iteration ограничивает количество запросов к одному Worker.


***

## Пример: Lead Outreach (практический кейс)

Цель: автоматизировать поиск и подготовку персонализированного письма потенциальному лидy. Доступен в Marketplace.

Состав:  

* Supervisor
* Lead Researcher (Worker) — использует, например, Google Search Tool для сбора информации по заданным критериям.
* Lead Sales Generator (Worker) — готовит персонализированный e-mail на основе найденной информации.

<figure><img src="https://823733684-files.gitbook.io/~/files/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F00tYLwhz5RyR7fJEhrWy%2Fuploads%2Fgit-blob-1fee1997b40f538d36d12c5439bd342272b4249b%2Fmas08.png?alt=media" alt=""><figcaption></figcaption></figure>

Сценарий:

* User (сотрудник Solterra Renewables) запрашивает:
 «Нужна информация по Evergreen Energy Group и её CEO Amelia Croft как потенциальному клиенту».
* Supervisor делегирует подзадачу Lead Research воркеру Lead Researcher.
* Lead Researcher собирает данные:
 * профиль компании: сфера, размер, локация;
 * свежие новости/события;
 * ключевые лица (подтверждает роль Amelia Croft как CEO).
 Возвращает результаты Supervisor’у.

* Supervisor подтверждает релевантность лида и передаёт воркеру Lead Sales Generator:
 * результаты ресёрча;
 * email Amelia Croft;
 * контекст о Solterra Renewables.
* Lead Sales Generator создаёт персонализированный черновик письма (учитывая роль CEO, потребности компании и найденный контекст) и возвращает его Supervisor’у.
* Supervisor выдаёт команду `FINISH` и возвращает письмо пользователю.  


Результат: пользователь получает готовый черновик письма для Amelia Croft.

